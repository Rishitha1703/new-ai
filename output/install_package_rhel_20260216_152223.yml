---
- name: Install python on servers
  hosts: all
  become: yes
  gather_facts: yes
  
  tasks:
    # Update package cache (Debian/Ubuntu)
    - name: Update apt cache (Debian/Ubuntu)
      apt:
        update_cache: yes
      when: ansible_os_family == "Debian"
      
    # Install on Debian/Ubuntu
    - name: Install python on Debian/Ubuntu
      apt:
        name: python
        state: present
      when: ansible_os_family == "Debian"
      
    # Install on RHEL/CentOS/Rocky/Alma
    - name: Install python on RHEL/CentOS
      yum:
        name: python
        state: present
      when: ansible_os_family == "RedHat"
      
    # Install on Fedora
    - name: Install python on Fedora
      dnf:
        name: python
        state: present
      when: ansible_os_family == "Fedora"
      
    # Verify installation (works on all)
    - name: Verify python is installed
      command: which python
      register: package_check
      changed_when: false
      failed_when: false
      
    - name: Display success message
      debug:
        msg: "âœ“ python installed successfully on {{ ansible_distribution }} {{ ansible_distribution_version }}"
      when: package_check.rc == 0


